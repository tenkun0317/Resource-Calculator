# Resource Calculator

## 概要

このツールは、複雑なアイテム生産における資源管理とクラフト要件を計算するために設計された強力なコマンドラインアプリケーションです。対話モードと、詳細な資源計画のためのコマンド群を備えています。

複雑なクラフトツリーを持つアイテムの生産において、どの基本素材がどれだけ必要になるか、また、どの中間素材が生成・消費されるかを詳細に追跡します。

## 主な機能

-   **対話型コマンドラインインターフェース**: 対話型セッションを通じて、または直接コマンドを使用して計算機と対話できます。
-   **必要資源の計算**: 現在のインベントリを考慮し、要求されたアイテムを生産するために必要な基本素材の総量を算出します。
-   **中間生成物の追跡**: クラフト過程で生成され、消費される中間アイテムを追跡・表示します。
-   **副産物と余剰生産物の管理**: レシピの実行によって生じる副産物や、必要量を超えて生産されたアイテムを計算に含めます。
-   **永続的なインベントリ管理**: セッションをまたいで利用可能な資源（在庫）を永続的に保持します。
    -   **アイテムの追加**: インベントリにアイテムと数量を簡単に追加できます。
    -   **アイテムのクリア**: 特定のアイテムを削除したり、インベントリ全体をクリアしたりできます。
    -   **インベントリの表示**: 現在インベントリにあるすべてのアイテムとその数量を表示します。
-   **逆引きクラフト計算**: 現在のインベントリに基づいて、どのアイテムをどれだけクラフトできるかを判断します。
-   **クラフトツリーの可視化**: アイテムの依存関係とクラフト手順をツリー形式で表示します。
-   **あいまい検索**: アイテム名に多少の誤りがあっても、最も近い名前のアイテムを推測して計算を実行します。
-   **外部レシピファイル**: クラフトレシピは `recipes.json` から動的に読み込まれます。
-   **レシピ一覧表示**: コマンドラインから利用可能なすべてのクラフトレシピを表示します。

## 使い方

このアプリケーションは、サブコマンドを持つコマンドラインインターフェースを使用します。

1.  **アプリケーションの実行**:
    ```sh
    python main.py <command> [arguments]
    ```

2.  **利用可能なコマンド**:

    -   **`calculate <item_name> [quantity]`**: アイテムに必要な資源を計算します。アイテムが指定されない場合、利用可能なアイテムを一覧表示します。
        -   例: `python main.py calculate "Astral Sheet" 2`
        -   例（対話型入力）: `python main.py calculate` (その後 `Astral Sheet, 2; Mana Crystal` と入力)

    -   **`add <item_name> [quantity]`**: 利用可能な資源にアイテムを追加します。
        -   例: `python main.py add "Rich Air" 10`

    -   **`clear [item_name]`**: 利用可能な資源からすべて、または特定のアイテムをクリアします。
        -   例: `python main.py clear "Mana Crystal"`
        -   例（すべてクリア）: `python main.py clear`

    -   **`reverse [item_name]`**: 利用可能な資源から何がクラフトできるかを表示します。アイテム名が指定された場合、その特定のアイテムの最大クラフト可能量を表示します。
        -   例: `python main.py reverse`
        -   例（特定のアイテム）: `python main.py reverse "Mana Crystal"`

    -   **`list`**: 利用可能な資源にあるすべてのアイテムを一覧表示します。
        -   例: `python main.py list`

    -   **`recipes`**: 利用可能なすべてのクラフトレシピを一覧表示します。
        -   例: `python main.py recipes`

    -   **`interactive`**: コマンドを継続的に入力できる対話モードに入ります。
        -   例: `python main.py interactive`
        -   対話モード内で、コマンドのリストを表示するには `help` と入力し、終了するには `exit` または `quit` と入力します。

    -   **`help`**: すべてのコマンドの詳細なヘルプを表示します。
        -   例: `python main.py help`

## `recipes.json` のファイル形式

レシピは `recipes.json` ファイルにJSON形式で定義します。ファイルはオブジェクトの配列です。

各レシピオブジェクトは `inputs` と `outputs` の2つのキーを持ちます。

-   `inputs`: レシピの材料となるアイテム名と数量のペアです。
-   `outputs`: レシピによって生産されるアイテム名と数量のペアです。

**レシピの例:**

```json
[
  {
    "inputs": {
      "Rich Air": 2
    },
    "outputs": {
      "Mana Crystal": 1
    }
  },
  {
    "inputs": {
      "Mana Crystal": 3
    },
    "outputs": {
      "Mana Dust": 2,
      "Liquid Curse": 1,
      "Silica Powder": 1
    }
  }
]
```

## テスト

単体テストは `tests/` ディレクトリにあります。`pytest` のようなテストランナー（インストールされている場合）を使用するか、個々のテストファイルを実行することでテストスイートを実行できます。

`pytest` を使用した例:

```sh
pytest
```

## 今後の改善点（アイデア）

-   **代替レシピの選択**: アイテムの複数のクラフトルートからユーザーが選択できるようにします。
-   **グラフィカルユーザーインターフェース (GUI)**: より直感的なビジュアルインターフェースを開発します。
-   **高度なレシピプロパティ**: クラフト時間、必要な設備、確率的な生産をレシピに組み込みます。
-   **エクスポート機能**: 計算結果をさまざまなファイル形式（CSV、JSONなど）にエクスポートします。
-   **設定ファイル**: `recipes.json` のパスなどの設定を外部化します。
-   **バッチ処理**: ファイルからアイテムリストを読み込み、結果をファイルに出力するバッチ処理モード。