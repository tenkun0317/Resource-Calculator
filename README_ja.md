# Resource Calculator

## 概要

このツールは、設定されたレシピに基づいて、特定のアイテムをクラフトするために必要な総資源量を計算するコマンドラインアプリケーションです。

複雑なクラフトツリーを持つアイテムの生産において、どの基本素材がどれだけ必要になるか、また、どの中間素材が生成・消費されるかを詳細に追跡します。

## 主な機能

- **必要資源の計算**: 要求されたアイテムを生産するために必要な基本素材の総量を算出します。
- **中間生成物の追跡**: クラフト過程で生成され、消費される中間アイテムを追跡・表示します。
- **副産物と余剰生産物の管理**: レシピの実行によって生じる副産物や、必要量を超えて生産されたアイテムを計算に含めます。
- **手持ち資源の利用**: 計算をまたいで利用可能な資源（在庫）を保持し、次の計算で自動的に利用します。
- **クラフトツリーの可視化**: アイテムの依存関係とクラフト手順をツリー形式で表示します。
- **あいまい検索**: アイテム名に多少の誤りがあっても、最も近い名前のアイテムを推測して計算を実行します。
- **外部レシピファイル**: クラフトレシピは `recipes.json` から動的に読み込まれます。

## 使い方

1.  ターミナルで `main.py` を実行します。
    ```sh
    python main.py
    ```
2.  プログラムが起動すると、計算したいアイテムと数量を入力するよう求められます。
3.  プロンプトに従って入力し、Enterキーを押すと計算結果が表示されます。
4.  プログラムを終了するには `quit` と入力します。

## 入力形式

計算したいアイテムを、以下の形式で入力します。

```
アイテム名1, 数量1; アイテム名2, 数量2
```

-   アイテムと数量はカンマ `,` で区切ります。
-   複数のアイテムはセミコロン `;` で区切ります。
-   数量を省略した場合、デフォルトで `1` が設定されます。

**入力例:**

```
Enter items to calculate (or 'quit'): Astral Sheet, 2; Mana Crystal
```

## 出力形式

計算結果は、以下のセクションに分かれて表示されます。

-   **Recipe Tree**: クラフトの依存関係と手順を示したツリーです。各アイテムが「レシピ」「在庫」「基本素材」のいずれから供給されるかが表示されます。
-   **Total base resources needed**: クラフト全体で必要となる基本素材（それ以上分解できない素材）の総量です。
-   **Products Breakdown**:
    -   **Finished products**: ユーザーが要求した最終製品です。
    -   **Intermediate products**: クラフト過程で生成され、消費された中間製品です。
    -   **Byproducts / Excess**: レシピ実行によって生じた副産物や余剰生産分です。
-   **Updated available resources**: 今回の計算で生じた副産物などを含む、次回の計算で利用可能な資源の一覧です。

## `recipes.json` のファイル形式

レシピは `recipes.json` ファイルにJSON形式で定義します。ファイルはオブジェクトの配列です。

各レシピオブジェクトは `inputs` と `outputs` の2つのキーを持ちます。

-   `inputs`: レシピの材料となるアイテム名と数量のペアです。
-   `outputs`: レシピによって生産されるアイテム名と数量のペアです。

**レシピの例:**

```json
[
  {
    "inputs": {
      "Rich Air": 2
    },
    "outputs": {
      "Mana Crystal": 1
    }
  },
  {
    "inputs": {
      "Mana Crystal": 3
    },
    "outputs": {
      "Mana Dust": 2,
      "Liquid Curse": 1,
      "Silica Powder": 1
    }
  }
]
```

## テスト

`test.py` に単体テストが含まれています。以下のコマンドでテストスイートを実行できます。

```sh
python test.py
```
